#!/bin/bash
#for linux
#掃描同網段活動主機及其開放端口
#the firt work in github
#創建於2023/5/6
#會創建"living_host.txt"和"open_port.txt"
#create by RedCollaredDove



read -p "input the ip adress-->"  ip_adress
nmap -sn $ip_adress/24 | grep 'for' | awk '{print $5}' > living_host.txt


cat living_host.txt
echo > open_port.txt
echo -e "\n"
echo -e "+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> open_port.txt


for line in $(cat living_host.txt)
        do
                        #echo $line
                the_last2_ip=${line: -2}
                        #echo $the_last2_ip
                the_last3_ip=${line: -3}
                        #echo $the_last3_ip


                if [[ $the_last2_ip != ".1" ]] && [[ $the_last2_ip != ".2" ]] && [[ $the_last3_ip != "254" ]]&& 
                        [[ $line != "$ip_adress" ]];then
                        
                        echo -e "++++++++++++++++++++"
                        echo "scanning $line"
                        echo -e "scan port of $line\n\n" >> open_port.txt
                        nmap -A -p- $line >> open_port.txt
                        echo "done"
                        echo -e "+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++" >> open_port.txt
                fi
        done
echo "+++++++++++++++++++"




